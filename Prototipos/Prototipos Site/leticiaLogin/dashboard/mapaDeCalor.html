<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-20">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/heatmap.js/2.0.0/heatmap.min.js"></script>
  <script src="https://kit.fontawesome.com/6921956092.js" crossorigin="anonymous"></script>
</head>

<body>
  <div class="container">
    <!-- MENU LATERAL -->
    <div id="menu">
      <div class="logo">
        <h1>In<span>Flow</span></h1>
      </div>
      <div class="escolha">
        <div class="box">
          <div class="icon">
            <i class="fa-solid fa-chart-line"></i>
          </div>
          <p class="titulo">Dashboard</p>
        </div>
        <div class="box">
          <div class="icon">
            <i class="fa-solid fa-users"></i>
          </div>
          <a href="cadastro.html" class="titulo">Adicionar usuários</a>
        </div>
        <div class="box">
          <div class="icon">
            <i class="fa-solid fa-gear"></i>
          </div>
          <p class="titulo">Configurações</p>
        </div>
      </div>
      <div class="dadosPerfil">
        <div class="fotoPerfil conteudo">
          <img src="assets/img/homem1.jpg" alt="">
        </div>
        <div class="infoPerfil conteudo">
          <p class="nome">Renato</p>
          <p class="email">renato.silva@gmail.com</p>
        </div>
        <div class="maisInfo conteudo">
          <i class="fa-solid fa-angle-right"></i>
        </div>
      </div>
    </div>
    <!-- FIM DO MENU LATERAL -->
    <div id="main">
      <div class="conteudoDashboard">
        <div class="elementosKPI">
          <div class="kpi k1">
            <p class="titulo">Corredor com Menor fluxo</p>
            <div class="dados">
              <p>Corredor 5</p>
              <p>:</p>
              <p>Tranquilo</p>
            </div>
          </div>
          <div class="kpi k2">
            <p class="titulo">Corredor com Maior fluxo</p>
            <div class="dados">
              <p>Corredor 1</p>
              <p>:</p>
              <p><b>ATENÇÃO</b></p>
            </div>
          </div>
          <div class="kpi k3">
            <p class="titulo">Corredor com Menor fluxo</p>
            <div class="dados">
              <p>Agora</p>
              <p>:</p>
              <p>10 pessoas</p>
            </div>
          </div>
          <div class="kpi k4">
            <p class="titulo">Corredor com Maior fluxo</p>
            <div class="dados">
              <p>Agora</p>
              <p>:</p>
              <p>80 pessoas</p>
            </div>
          </div>
        </div>
        <div class="heatmaparea">
          <h1>Mapa de calor</h1>
          <p>Acompanhe em tempo real a movimentação</p>
          <div class="heatmap">
            <div id="heatmapContainer"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>
</body>

</html>
<script>
  const heatmapInstance = h337.create({
    container: document.getElementById('heatmapContainer'),
    radius: 70,
  });

  var dadosPorLocal = {
            'local1': [
                { x: 95, y: 175, value: 30, radius: 130, dataHora: '2024-10-01T10:30' },
                { x: 95, y: 175, value: 40, radius: 130, dataHora: '2024-10-01T11:15' },
                { x: 95, y: 175, value: 50, radius: 130, dataHora: '2024-10-01T11:45' }
            ],
            'local2': [
                { x: 310, y: 225, value: 20, radius: 90, dataHora: '2024-10-02T10:45' },
                { x: 310, y: 225, value: 30, radius: 90, dataHora: '2024-10-02T11:20' },
                { x: 310, y: 225, value: 40, radius: 90, dataHora: '2024-10-02T11:50' }
            ],
            'local3': [
                { x: 545, y: 190, value: 60, radius: 100, dataHora: '2024-10-01T11:10' },
                { x: 545, y: 190, value: 70, radius: 100, dataHora: '2024-10-01T11:30' },
                { x: 545, y: 190, value: 80, radius: 100, dataHora: '2024-10-01T12:00' }
            ],
            'local4': [
                { x: 190, y: 364, value: 50, radius: 130, dataHora: '2024-10-02T11:00' },
                { x: 190, y: 364, value: 60, radius: 130, dataHora: '2024-10-02T11:40' },
                { x: 190, y: 364, value: 70, radius: 130, dataHora: '2024-10-02T12:15' }
            ],
            'local5': [
                { x: 400, y: 365, value: 80, radius: 130, dataHora: '2024-10-03T11:05' },
                { x: 400, y: 365, value: 40, radius: 130, dataHora: '2024-10-03T11:35' },
                { x: 400, y: 365, value: 50, radius: 130, dataHora: '2024-10-03T12:10' }
            ]
        };

        heatmapInstance.setData(data);

          // Função para converter data e hora em um objeto Date
          function converterParaDataCompleta(data, hora) {
            return new Date(`${data}T${hora}`);
        }

        // Função para aplicar o filtro de intervalo de data e hora e adicionar os dados ao heatmap
        function filtrarDadosPorDataHora() {
            var dataInicial = document.getElementById('data-inicial').value;
            var dataFinal = document.getElementById('data-final').value;
            var horaIntervalo = document.getElementById('hora').value;

            // Separar a hora inicial e final do intervalo selecionado
            var horas = horaIntervalo.split("-");
            var horaInicial = horas[0];
            var horaFinal = horas[1];

            // Converter os dados e horários em objetos Date
            var dataHoraInicial = converterParaDataCompleta(dataInicial, horaInicial);
            var dataHoraFinal = converterParaDataCompleta(dataFinal, horaFinal);

            if (dataHoraFinal < dataHoraInicial) {
                alert("A data e hora final devem ser maiores ou iguais à data e hora inicial.");
                return;
            }

            // Limpar o heatmap antes de adicionar novos dados
            instanciaHeatmap.setData({ max: 0, data: [] });

            // Percorrer todos os locais
            for (var local in dadosPorLocal) {
                var dadosDoLocal = dadosPorLocal[local];

                // Percorrer cada ponto de dados dentro de um local
                for (var i = 0; i < dadosDoLocal.length; i++) {
                    var ponto = dadosDoLocal[i];
                    var dataHoraPonto = new Date(ponto.dataHora);

                    // Verificar se o ponto de dados está dentro do intervalo de data e hora
                    if (dataHoraPonto >= dataHoraInicial && dataHoraPonto <= dataHoraFinal) {
                        // Usando addData para adicionar os pontos ao heatmap
                        instanciaHeatmap.addData(ponto);
                    }
                }
            }
        }
        for (var k in dadosPorLocal) {
            console.log(k);
        }
        console.log(Object.keys(dadosPorLocal))
        // Carregar os dados iniciais
        filtrarDadosPorDataHora();
</script>